#!/usr/bin/env bash

set -e

dry="--dry-run"
[[ "$1" == "--real" ]] && dry=""

for i in "$HOME/dotfiles/"*/; do
    dirname=$(basename "$i")
    if [[ -d "$HOME/.config/$dirname" ]]; then
        rsync -avh $dry --progress --delete "$HOME/.config/$dirname/" "$i"
    fi
done

sed -i 's/client_id = ".*"/client_id = "" # go to https:\/\/developer.spotify.com\/dashboard/' \
    "$HOME/dotfiles/spotify-player/app.toml"

pacman -Qqen > "$HOME/dotfiles/pkglist.txt"
paru -Qqem > "$HOME/dotfiles/aurpkg.txt"
flatpak list --app --columns=app >  "$HOME/dotfiles/flatpak.txt"

rsync -avh $dry --progress "$HOME/.bashrc" "$HOME/dotfiles/.bashrc"
rsync -avh $dry --progress "$HOME/.zshrc" "$HOME/dotfiles/.zshrc"
rsync -avh $dry --progress "$HOME/.vimrc" "$HOME/dotfiles/.vimrc"
rsync -avh $dry --progress "$HOME/.tmux.conf" "$HOME/dotfiles/.tmux.conf"

rsync -avh $dry --progress \
  --exclude-from="$HOME/dotfiles/.gitignore" \
  "$HOME/.local/bin/" "$HOME/dotfiles/scripts/"
